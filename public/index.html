<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Article Cloner - LP自動クローン</title>
<link rel="stylesheet" href="/css/app.css">
<link rel="stylesheet" href="/css/editor.css">
</head>
<body>

<!-- 画面1: URL入力 -->
<div id="screen-landing" class="screen active">
  <div class="landing-bg"></div>
  <div class="landing-content">
    <div class="landing-logo">
      <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
        <rect width="40" height="40" rx="10" fill="url(#g1)"/>
        <path d="M12 14h16v2H12zm0 5h12v2H12zm0 5h14v2H12z" fill="#fff" opacity="0.9"/>
        <defs><linearGradient id="g1" x1="0" y1="0" x2="40" y2="40"><stop stop-color="#3B82F6"/><stop offset="1" stop-color="#8B5CF6"/></linearGradient></defs>
      </svg>
      <h1>Article Cloner</h1>
    </div>
    <p class="landing-subtitle">競合LPをスクレイプ → ブロック編集 → Squad Beyond互換HTMLを出力</p>
    <div class="url-input-card">
      <div class="url-input-wrapper">
        <svg class="url-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M8.5 13.5l-1.414 1.414a3 3 0 01-4.243-4.243l3-3a3 3 0 014.243 0M11.5 6.5l1.414-1.414a3 3 0 014.243 4.243l-3 3a3 3 0 01-4.243 0" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <input type="url" id="url-input" placeholder="クローンしたいLPのURLをペースト..." autocomplete="off" spellcheck="false">
        <button id="btn-start" class="btn-primary" disabled>
          <span>クローン開始</span>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 8h10m-4-4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>
    </div>
    <div class="landing-features">
      <div class="feature-chip"><span class="feature-dot" style="background:#3B82F6"></span>自動スクレイプ</div>
      <div class="feature-chip"><span class="feature-dot" style="background:#8B5CF6"></span>ブロック編集</div>
      <div class="feature-chip"><span class="feature-dot" style="background:#EC4899"></span>AI画像生成</div>
      <div class="feature-chip"><span class="feature-dot" style="background:#10B981"></span>SB互換出力</div>
    </div>
    <!-- Gemini APIキー設定カード -->
    <div class="api-key-card" id="api-key-card">
      <div class="api-key-header">
        <div class="api-key-status" id="api-key-status">
          <span class="status-dot"></span>
          <span class="api-key-status-text">確認中...</span>
        </div>
        <span class="api-key-label">Gemini API</span>
      </div>
      <div class="api-key-body" id="api-key-body">
        <p class="api-key-desc">AI画像生成・テキスト書き換えに必要です。<a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener" class="api-key-link">Google AI Studio</a> で無料で取得できます。</p>
        <div class="api-key-input-row">
          <input type="password" id="api-key-input" class="api-key-input" placeholder="APIキーをペースト..." autocomplete="off" spellcheck="false">
          <button id="btn-save-key" class="btn-save-key">保存</button>
        </div>
        <div class="api-key-hint" id="api-key-hint"></div>
      </div>
    </div>

    <div class="landing-footer">
      <span class="footer-version">v1.1.0</span>
    </div>
  </div>
</div>

<!-- セットアップガイドモーダル -->
<div id="modal-setup" class="modal">
  <div class="modal-backdrop"></div>
  <div class="modal-content modal-lg">
    <div class="modal-header">
      <h3>セットアップガイド</h3>
      <button class="modal-close" data-close-modal="modal-setup">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M5 5l10 10M15 5L5 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="setup-section">
        <h4>1. Gemini APIキーの設定</h4>
        <p>AI画像生成・テキスト書き換え機能に必要です。</p>
        <div class="setup-code">
          <code># .env ファイルを編集<br>
GEMINI_API_KEY_1=your_key_here<br><br>
# キーの取得先:<br>
# https://aistudio.google.com/apikey</code>
        </div>
      </div>
      <div class="setup-section">
        <h4>2. 使い方</h4>
        <ol class="setup-steps">
          <li>クローンしたいLPのURLを入力</li>
          <li>自動スクレイプ → ブロック分解</li>
          <li>各ブロックをクリックして編集（手動 or AI）</li>
          <li>テキスト一括差し替えで商品名・URL変更</li>
          <li>ビルド → SB互換HTMLをダウンロード</li>
        </ol>
      </div>
      <div class="setup-section">
        <h4>3. AI編集モード</h4>
        <p>テキストブロック選択時に「AI編集」タブを使うと、Gemini APIで自動書き換えできます。</p>
        <ul class="setup-list">
          <li>「トンマナを変えて大人っぽく」</li>
          <li>「煽りを強めて」</li>
          <li>「別商品に差し替えて」</li>
        </ul>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-primary" data-close-modal="modal-setup">閉じる</button>
    </div>
  </div>
</div>

<!-- 画面2: スクレイプ進捗 -->
<div id="screen-loading" class="screen">
  <div class="loading-content">
    <h2 class="loading-title">クローン処理中...</h2>
    <p class="loading-url" id="loading-url"></p>
    <div class="progress-segments">
      <div class="segment" id="seg-scrape">
        <div class="segment-bar"><div class="segment-fill"></div></div>
        <span class="segment-label">取得</span>
      </div>
      <div class="segment-arrow">&rarr;</div>
      <div class="segment" id="seg-parse">
        <div class="segment-bar"><div class="segment-fill"></div></div>
        <span class="segment-label">解析</span>
      </div>
      <div class="segment-arrow">&rarr;</div>
      <div class="segment" id="seg-ready">
        <div class="segment-bar"><div class="segment-fill"></div></div>
        <span class="segment-label">完了</span>
      </div>
    </div>
    <div class="live-counters">
      <div class="counter-item">
        <span class="counter-value" id="counter-assets">-</span>
        <span class="counter-label">アセット</span>
      </div>
      <div class="counter-item">
        <span class="counter-value" id="counter-blocks">-</span>
        <span class="counter-label">ブロック</span>
      </div>
      <div class="counter-item">
        <span class="counter-value" id="counter-sections">-</span>
        <span class="counter-label">セクション</span>
      </div>
    </div>
    <div class="log-panel" id="log-panel">
      <div class="log-entries" id="log-entries"></div>
    </div>
  </div>
</div>

<!-- 画面3: メインエディタ -->
<div id="screen-editor" class="screen">
  <div class="editor-toolbar">
    <div class="toolbar-left">
      <button class="toolbar-btn" id="btn-back" title="戻る">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M10 3L5 8l5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <span class="toolbar-title" id="toolbar-title">エディタ</span>
      <span class="toolbar-badge" id="toolbar-block-count"></span>
    </div>
    <div class="toolbar-center">
      <button class="toolbar-btn" id="btn-text-modify" title="一括テキスト差し替え">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 4h12M2 8h8M2 12h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        <span>テキスト一括差し替え</span>
      </button>
    </div>
    <div class="toolbar-right">
      <button class="toolbar-btn btn-accent" id="btn-build" title="SB互換HTMLを生成">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 8l3 3 5-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span>ビルド</span>
      </button>
      <button class="toolbar-btn" id="btn-export" title="HTMLをダウンロード" disabled>
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 2v8m-3-3l3 3 3-3M3 12v1h10v-1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span>書き出し</span>
      </button>
    </div>
  </div>

  <div class="split-pane">
    <div class="pane pane-left" id="pane-left">
      <div class="pane-header">
        <div class="pane-tabs">
          <button class="pane-tab active" data-tab="blocks">ブロック一覧</button>
          <button class="pane-tab" data-tab="code">HTML構造</button>
        </div>
      </div>
      <div class="pane-body">
        <div class="tab-content active" id="tab-blocks">
          <div class="block-list" id="block-list"></div>
        </div>
        <div class="tab-content" id="tab-code">
          <div class="code-editor" id="code-editor"></div>
        </div>
      </div>
    </div>
    <div class="split-divider" id="split-divider"><div class="divider-handle"></div></div>
    <div class="pane pane-right" id="pane-right">
      <div class="pane-header">
        <span class="pane-label">プレビュー</span>
        <span class="preview-viewport">412px</span>
      </div>
      <div class="preview-container">
        <iframe id="preview-iframe" sandbox="allow-scripts allow-same-origin"></iframe>
      </div>
    </div>
  </div>
</div>

<!-- 編集パネル (スライドアウト) -->
<div id="edit-panel" class="edit-panel">
  <div class="edit-panel-header">
    <div class="edit-panel-title">
      <span class="edit-panel-type" id="edit-panel-type">text</span>
      <span>ブロック <span id="edit-panel-index">0</span></span>
    </div>
    <button class="edit-panel-close" id="edit-panel-close">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M5 5l10 10M15 5L5 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
    </button>
  </div>
  <!-- 編集モード切替 -->
  <div class="edit-mode-toggle">
    <button class="mode-btn active" data-mode="manual">手動編集</button>
    <button class="mode-btn" data-mode="ai">AI編集</button>
  </div>
  <div class="edit-panel-body" id="edit-panel-body"></div>
</div>

<!-- テキスト一括差し替えモーダル -->
<div id="modal-text-modify" class="modal">
  <div class="modal-backdrop"></div>
  <div class="modal-content modal-lg">
    <div class="modal-header">
      <h3>テキスト一括差し替え</h3>
      <button class="modal-close" data-close-modal="modal-text-modify">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M5 5l10 10M15 5L5 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <!-- タブ切り替え -->
      <div class="modal-tabs">
        <button class="modal-tab active" data-modal-tab="tab-bulk-replace">一括置換</button>
        <button class="modal-tab" data-modal-tab="tab-block-text">ブロック別</button>
        <button class="modal-tab" data-modal-tab="tab-find-replace">検索と置換</button>
      </div>

      <!-- タブ1: 一括置換（既存） -->
      <div class="modal-tab-content active" id="tab-bulk-replace">
        <div class="form-section">
          <label class="form-label">直接置換（旧テキスト → 新テキスト）</label>
          <div id="replacements-list" class="replacements-list">
            <div class="replacement-row">
              <input type="text" placeholder="旧テキスト（例：商品名）" class="input-old">
              <span class="arrow">&rarr;</span>
              <input type="text" placeholder="新テキスト" class="input-new">
              <button class="btn-remove-row" title="削除">&times;</button>
            </div>
          </div>
          <button class="btn-add-row" id="btn-add-replacement">+ 行を追加</button>
        </div>
        <div class="form-section">
          <label class="form-label">CTA URL差し替え</label>
          <input type="url" id="cta-url-input" class="form-input" placeholder="新しい遷移先URL...">
        </div>
        <div class="form-section">
          <label class="form-label">検出された頻出キーワード（クリックで追加）</label>
          <div id="frequent-terms" class="frequent-terms"></div>
        </div>
      </div>

      <!-- タブ2: ブロック別テキスト -->
      <div class="modal-tab-content" id="tab-block-text">
        <div class="form-section">
          <label class="form-label">テキストブロック一覧（右側を編集して適用）</label>
          <div class="block-text-list" id="block-text-list"></div>
        </div>
      </div>

      <!-- タブ3: 検索と置換 -->
      <div class="modal-tab-content" id="tab-find-replace">
        <div class="find-replace-section">
          <div class="find-replace-row">
            <label class="form-label" style="min-width:60px;margin:0">検索:</label>
            <input type="text" id="find-input" class="find-replace-input" placeholder="検索テキスト...">
            <span class="find-replace-count" id="find-count">0件</span>
          </div>
          <div class="find-replace-row">
            <label class="form-label" style="min-width:60px;margin:0">置換:</label>
            <input type="text" id="replace-input" class="find-replace-input" placeholder="置換テキスト...">
          </div>
          <div class="find-replace-actions">
            <button class="btn-secondary" id="btn-find-count">マッチ数を確認</button>
            <button class="btn-primary" id="btn-find-replace-all">一括置換</button>
          </div>
          <div id="find-replace-preview" class="form-section" style="margin-top:12px"></div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" data-close-modal="modal-text-modify">キャンセル</button>
      <button class="btn-primary" id="btn-apply-text-modify">差し替えを適用</button>
    </div>
  </div>
</div>

<!-- 書き出しモーダル -->
<div id="modal-export" class="modal">
  <div class="modal-backdrop"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3>SB互換HTML書き出し</h3>
      <button class="modal-close" data-close-modal="modal-export">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M5 5l10 10M15 5L5 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="validation-section" id="validation-section">
        <h4>SB互換チェック</h4>
        <div id="validation-results"></div>
      </div>
      <div class="export-stats" id="export-stats"></div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" id="btn-copy-html">クリップボードにコピー</button>
      <button class="btn-primary" id="btn-download-html">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 2v8m-3-3l3 3 3-3M3 12v1h10v-1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        HTMLをダウンロード
      </button>
    </div>
  </div>
</div>

<div id="toast-container" class="toast-container"></div>

<script type="module" src="/js/api.js"></script>
<script type="module" src="/js/panels.js"></script>
<script type="module" src="/js/editor.js"></script>
<script type="module" src="/js/app.js"></script>
</body>
</html>
